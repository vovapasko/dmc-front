<div class="container-fluid">
    <app-page-title title="Проекты" [breadcrumbItems]="breadCrumbItems"></app-page-title>

    <div class="row mb-2">
        <div class="col-sm-4">
            <button type="button" (click)="openModal(addNewProjectModal)" class="btn btn-danger btn-rounded mb-3">
                <i class="mdi mdi-plus"></i>
                Создать проект
            </button>
        </div>
        <div class="col-sm-8">
            <div class="text-sm-right">
                <div class="btn-group mb-3">
                    <button type="button" (click)="order = null" class="btn btn-primary">Все</button>
                </div>
                <div class="btn-group mb-3 ml-1">
                    <button type="button" (click)="order = orders.confirmed" class="btn btn-light">Подтвержденные
                    </button>
                    <button type="button" (click)="order = orders.notconfirmed" class="btn btn-light">На согласовании
                    </button>
                </div>
            </div>
        </div>
        <!-- end col-->
    </div>
    <!-- end row-->

    <div class="row">
        <app-ui-preloader [display]="loading$ | async"></app-ui-preloader>

        <div class="col-xl-4" *ngFor="let project of projects$ | async | projectStatus: order; index as index">
            <div class="card-box project-box">
                <div class="dropdown float-right" ngbDropdown>
                    <a
                            href="javascript: void(0);"
                            class="dropdown-toggle card-drop arrow-none"
                            ngbDropdownToggle
                            aria-expanded="false"
                    >
                        <i class="mdi mdi-dots-horizontal m-0 text-muted h3"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" ngbDropdownMenu>
                        <a class="dropdown-item" (click)="onChange(project?.id)"
                           href="javascript: void(0);">Изменить</a>
                    </div>
                </div>
                <!-- Title-->
                <h4 class="mt-0">
                    <a href="javascript: void(0);" class="text-dark">{{ project?.projectName }}</a>
                </h4>
                <p class="text-muted text-uppercase">
                    <span>Менеджер проекта </span> <i class="mdi mdi-account-circle"></i> <small>{{ project?.projectManager }}</small>
                </p>
                <p class="text-muted text-uppercase">
                    <span>Метод разгона </span> <i class="mdi mdi-account-circle"></i> <small>{{ project?.projectBurstMethod }}</small>
                </p>
                <div class="badge bg-soft-success text-success mb-3" [ngClass]="{ 'bg-soft-dark text-dark': project?.isConfirmed }">
                    {{ project?.isConfirmed ? 'подтвержден' : 'на согласовании' }}
                </div>
                <!-- Desc-->
                <p class="text-muted font-13 mb-3 sp-line-2">
                    {{ project?.clientName }}
                </p>
                <!-- Task info-->
                <p class="mb-1">
          <span class="pr-2 text-nowrap mb-2 d-inline-block">
            <i class="mdi mdi-format-list-bulleted-type text-muted"></i>
            <b> {{ project?.projectHashtags?.length }}</b> Хештеги
          </span>
                    <span class="text-nowrap mb-2 d-inline-block">
            <i class="mdi mdi-comment-multiple-outline text-muted"></i>
            <b> {{ project?.projectContractors?.length }}</b> Контрагенты
          </span>
                </p>
                <button type="button" class="btn btn-sm btn-blue waves-effect waves-light float-right">
                    <i class="mdi mdi-eye-circle"></i> Посмотреть
                </button>
            </div>
            <!-- end card box-->
        </div>
        <!-- end col-->
    </div>
</div>

<!-- Add new project modal  -->
<ng-template #addNewProjectModal role="document" let-modal="close">
    <div class="modal-header bg-dark">
        <h4 class="modal-title text-white">Добавить новый проект</h4>
        <button
                type="button"
                class="close text-white"
                aria-label="Close"
                id="addNewFormatModal"
                (click)="modal('Cross click')"
        >
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body p-3">
        <div class="text-left">
            <form (ngSubmit)="addNewProject()" [formGroup]="createProjectForm">
                <div class="form-group">
                    <label for="projectName"> Название </label>
                    <input
                            type="text"
                            formControlName="projectName"
                            class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && f.projectName.errors }"
                            id="projectName"
                            placeholder="Введите название проекта"
                    />

                    <div *ngIf="submitted && f.projectName.errors" class="invalid-feedback">
                        <div *ngIf="f.projectName.errors.required">Название проекта обязательно</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="deletePostFormat"> Менджер проекта </label>
                    <ng-select
                            id="deletePostFormat"
                            [items]="users$ | async"
                            bindLabel="email"
                            bindValue="id"
                            [closeOnSelect]="false"
                            [hideSelected]="true"
                            placeholder="Выберите менеджера проекта"
                            formControlName="projectManager"
                            [ngClass]="{ 'is-invalid': submitted && f.projectManager.errors }"
                    ></ng-select>
                    <div *ngIf="submitted && f.projectManager.errors" class="invalid-feedback">
                        <span *ngIf="f.projectManager.errors.required"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="projectHashtags"> Хештеги </label>

                    <ng-select
                            id="projectHashtags"
                            [items]="hashtags$ | async"
                            bindLabel="name"
                            [multiple]="true"
                            [closeOnSelect]="false"
                            [hideSelected]="true"
                            placeholder="Выберите ключевые слова"
                            formControlName="projectHashtags"
                            [ngClass]="{ 'is-invalid': submitted && f.projectHashtags.errors }"
                    ></ng-select>
                    <div *ngIf="submitted && f.projectHashtags.errors" class="invalid-feedback">
                        <span *ngIf="f.projectHashtags.errors.required"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="projectContractors"> Котрагенты </label>
                    <ng-select
                            id="projectContractors"
                            [items]="contractors$ | async"
                            bindLabel="editorName"
                            [multiple]="true"
                            [closeOnSelect]="false"
                            [hideSelected]="true"
                            placeholder="Выберите контрагентов"
                            formControlName="projectContractors"
                            [ngClass]="{ 'is-invalid': submitted && f.projectContractors.errors }"
                    >
                    </ng-select>
                    <div *ngIf="submitted && f.projectContractors.errors" class="invalid-feedback">
                        <span *ngIf="f.projectContractors.errors.required"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="projectBudget"> Бюджет разгона </label>

                    <input
                            type="number"
                            id="projectBudget"
                            formControlName="projectBudget"
                            class="form-control"
                            placeholder="Введите бюджет"
                            [ngClass]="{ 'is-invalid': submitted && f.projectBudget.errors }"
                    />
                    <div *ngIf="submitted && f.projectBudget.errors" class="invalid-feedback">
                        <span *ngIf="f.projectBudget.errors.required"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="projectMail"> Почта </label>
                    <input
                            type="email"
                            formControlName="projectMail"
                            class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && f.projectName.errors }"
                            id="projectMail"
                            placeholder="Введите почту"
                    />

                    <div *ngIf="submitted && f.projectMail.errors" class="invalid-feedback">
                        <div *ngIf="f.projectMail.errors.required">Почта проекта обязательна</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="projectClient"> Клиент </label>
                    <input
                            type="text"
                            formControlName="projectClient"
                            class="form-control"
                            [ngClass]="{ 'is-invalid': submitted && f.projectClient.errors }"
                            id="projectClient"
                            placeholder="Введите клиента"
                    />

                    <div *ngIf="submitted && f.projectClient.errors" class="invalid-feedback">
                        <div *ngIf="f.projectClient.errors.required">Поле клиент обязательно</div>
                    </div>
                </div>

                <div class="text-right">
                    <button type="submit" class="btn btn-success">Сохранить</button>
                    <button type="button" class="btn btn-danger ml-1" (click)="modal('close click')">Отменить</button>
                </div>
            </form>
        </div>
    </div>
</ng-template>