<div class="container-fluid">
    <app-page-title title="Разгон" [breadcrumbItems]="breadCrumbItems"></app-page-title>

    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-body">
                    <aw-wizard #wizardForm>
                        <aw-wizard-step (stepEnter)="step = 0" [canExit]="validationForm?.valid">
                            <ul class="nav nav-pills bg-light nav-justified form-wizard-header mb-4">
                                <li class="nav-item" [awGoToStep]="{ stepIndex: 0 }">
                                    <a
                                            href="javascript: void(0);"
                                            data-toggle="tab"
                                            [ngClass]="{ active: step == 0 }"
                                            class="nav-link rounded-0 pt-2 pb-2"
                                    >
                                        <i class="mdi mdi-account-circle mr-1"></i>
                                        <span class="d-none d-sm-inline">Общее</span>
                                    </a>
                                </li>

                                <li *ngIf="!commonFormControls?.projectBurstMethod?.value?.method" class="nav-item">
                                    <a href="javascript: void(0);" class="nav-link rounded-0 pt-2 pb-2">
                                        <span class="d-none d-sm-inline">...</span>
                                    </a>
                                </li>

                                <li *ngIf="commonFormControls?.projectBurstMethod?.value?.method == methods.bayer || commonFormControls?.projectBurstMethod?.value?.method == methods.topSecret"
                                    class="nav-item" [awGoToStep]="{ stepIndex: 1 }"
                                >
                                    <a
                                            href="javascript: void(0);"
                                            data-toggle="tab"
                                            [ngClass]="{ active: step == 1 }"
                                            class="nav-link rounded-0 pt-2 pb-2"
                                    >
                                        <i class="mdi mdi-face-profile mr-1"></i>
                                        <span class="d-none d-sm-inline">Формирование</span>
                                    </a>
                                </li>

                                <li *ngIf="commonFormControls?.projectBurstMethod?.value?.method == methods.direct"
                                    class="nav-item"
                                    [awGoToStep]="{ stepIndex: 2 }">
                                    <a
                                            href="javascript: void(0);"
                                            data-toggle="tab"
                                            [ngClass]="{ active: step == 2 }"
                                            class="nav-link rounded-0 pt-2 pb-2"
                                    >
                                        <i class="mdi mdi-face-profile mr-1"></i>
                                        <span class="d-none d-sm-inline">Распределение</span>
                                    </a>
                                </li>

                                <li class="nav-item" [awGoToStep]="{ stepIndex: 3 }">
                                    <a
                                            href="javascript: void(0);"
                                            data-toggle="tab"
                                            [ngClass]="{ active: step == 3 }"
                                            class="nav-link rounded-0 pt-2 pb-2"
                                    >
                                        <i class="mdi mdi-checkbox-marked-circle-outline mr-1"></i>
                                        <span class="d-none d-sm-inline">Предпросмотр</span>
                                    </a>
                                </li>
                            </ul>
                            <form (ngSubmit)="formSubmit()" [formGroup]="validationForm">
                                <div class="row">
                                    <app-ui-preloader [display]="loading$ | async"></app-ui-preloader>

                                    <div class="col-xl-8">
                                        <div class="form-group row mb-3">
                                            <label for="clientName" class="col-md-3 col-form-label"> Клиент </label>
                                            <div class="col-md-9">
                                                <ng-select
                                                        id="clientName"
                                                        [items]="clients$ | async"
                                                        bindLabel="name"
                                                        [multiple]="false"
                                                        [clearSearchOnAdd]="true"
                                                        [closeOnSelect]="true"
                                                        [hideSelected]="true"
                                                        placeholder="Выберите клиента"
                                                        formControlName="clientName"
                                                        [ngClass]="{ 'is-invalid': submitted && commonFormControls.clientName.errors }"
                                                >
                                                </ng-select>
                                                <div *ngIf="submitted && commonFormControls.clientName.errors"
                                                     class="invalid-feedback">
                                                    <span *ngIf="commonFormControls.clientName.errors.required"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group row mb-3">
                                            <label for="projectPostFormat" class="col-md-3 col-form-label">
                                                Проект </label>
                                            <div class="col-md-9">
                                                <ng-select
                                                        id="project"
                                                        [items]="newsProjects$ | async"
                                                        bindLabel="name"
                                                        [clearSearchOnAdd]="true"
                                                        (change)="onChangeProject($event)"
                                                        [closeOnSelect]="true"
                                                        placeholder="Выберите проект"
                                                        formControlName="projectName"
                                                        [ngClass]="{ 'is-invalid': submitted && commonFormControls.projectName.errors }"
                                                ></ng-select>
                                                <div *ngIf="submitted && commonFormControls.projectName.errors"
                                                     class="invalid-feedback">
                                                    <span *ngIf="commonFormControls.projectName.errors.required"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group row mb-3">
                                            <label for="character" class="col-md-3 col-form-label"> Характер
                                                новости </label>
                                            <div class="col-md-9">
                                                <ng-select
                                                        id="character"
                                                        [items]="characters$ | async"
                                                        bindLabel="character"
                                                        [closeOnSelect]="true"
                                                        [clearSearchOnAdd]="true"
                                                        placeholder="Выберите характер новости"
                                                        formControlName="newsCharacter"
                                                        [ngClass]="{ 'is-invalid': submitted && commonFormControls.newsCharacter.errors }"
                                                ></ng-select>
                                                <div *ngIf="submitted && commonFormControls.newsCharacter.errors"
                                                     class="invalid-feedback">
                                                    <span *ngIf="commonFormControls.newsCharacter.errors.required"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group row mb-3">
                                            <label for="projectTitle" class="col-md-3 col-form-label"> Заглавие </label>
                                            <div class="col-md-9">
                                                <input type="text"
                                                       id="projectTitle"
                                                       formControlName="projectTitle"
                                                       placeholder="Введите заглавие"
                                                       class="form-control"
                                                       [ngClass]="{ 'is-invalid': submitted && commonFormControls.projectTitle.errors }"
                                                />
                                                <div *ngIf="submitted && commonFormControls.projectTitle.errors"
                                                     class="invalid-feedback">
                                                    <span *ngIf="commonFormControls.projectTitle.errors.required"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group row mb-3">
                                            <label for="projectHashtags" class="col-md-3 col-form-label">
                                                Хештег </label>
                                            <div class="col-md-9">
                                                <ng-select
                                                        id="projectHashtags"
                                                        [items]="hashtags$ | async"
                                                        bindLabel="name"
                                                        [clearSearchOnAdd]="true"
                                                        [multiple]="true"
                                                        [closeOnSelect]="false"
                                                        [hideSelected]="true"
                                                        placeholder="Выберите ключевые слова"
                                                        formControlName="projectHashtags"
                                                        [ngClass]="{ 'is-invalid': submitted && commonFormControls.projectHashtags.errors }"
                                                ></ng-select>
                                                <div *ngIf="submitted && commonFormControls.projectHashtags.errors"
                                                     class="invalid-feedback">
                                                    <span *ngIf="commonFormControls.projectHashtags.errors.required"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group row mb-3">
                                            <label for="projectPostFormat" class="col-md-3 col-form-label"> Формат
                                                размещения </label>
                                            <div class="col-md-8">
                                                <ng-select
                                                        id="projectPostFormat"
                                                        [items]="formats$ | async"
                                                        bindLabel="postFormat"
                                                        [clearSearchOnAdd]="true"
                                                        (change)="initPriceControls()"
                                                        [multiple]="true"
                                                        [closeOnSelect]="false"
                                                        placeholder="Выберите формат"
                                                        formControlName="projectPostFormat"
                                                        [ngClass]="{ 'is-invalid': submitted && commonFormControls.projectPostFormat.errors }"
                                                ></ng-select>
                                                <div *ngIf="submitted && commonFormControls.projectPostFormat.errors"
                                                     class="invalid-feedback">
                                                    <span *ngIf="commonFormControls.projectPostFormat.errors.required"></span>
                                                </div>
                                            </div>
                                            <div class="col-md-1">
                                                <a (click)="openModal(editPrice)" href="javascript:void(0);"
                                                   class="action-icon"> <i class="mdi mdi-square-edit-outline"></i></a>
                                            </div>
                                        </div>

                                        <div class="form-group row mb-3">
                                            <label for="projectBurstMethod" class="col-md-3 col-form-label"> Метод
                                                разгона </label>
                                            <div class="col-md-9">
                                                <ng-select
                                                        id="projectBurstMethod"
                                                        [items]="methods$ | async"
                                                        bindLabel="method"
                                                        [clearSearchOnAdd]="true"
                                                        [closeOnSelect]="true"
                                                        placeholder="Выберите метод"
                                                        formControlName="projectBurstMethod"
                                                        [ngClass]="{ 'is-invalid': submitted && commonFormControls.projectBurstMethod.errors }"
                                                ></ng-select>
                                                <div *ngIf="submitted && commonFormControls.projectBurstMethod.errors"
                                                     class="invalid-feedback">
                                                    <span *ngIf="commonFormControls.projectBurstMethod.errors.required"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group row mb-3">
                                            <label for="projectBudget" class="col-md-3 col-form-label"> Бюджет
                                                разгона </label>
                                            <div class="col-md-9">
                                                <input type="number"
                                                       min="0"
                                                       id="projectBudget"
                                                       formControlName="projectBudget"
                                                       class="form-control"
                                                       placeholder="Введите бюджет"
                                                       [ngClass]="{ 'is-invalid': submitted && commonFormControls.projectBudget.errors }"
                                                />
                                                <div *ngIf="submitted && commonFormControls.projectBudget.errors"
                                                     class="invalid-feedback">
                                                    <span *ngIf="commonFormControls.projectBudget.errors.required"></span>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group row mb-3">
                                            <label for="projectContractors" class="col-md-3 col-form-label">
                                                Котрагенты </label>
                                            <div class="col-md-9">
                                                <ng-select
                                                        id="projectContractors"
                                                        [items]="contractors$ | async"
                                                        bindLabel="editorName"
                                                        [multiple]="true"
                                                        [closeOnSelect]="false"
                                                        [clearSearchOnAdd]="true"
                                                        [hideSelected]="true"
                                                        (change)="initPriceControls()"
                                                        placeholder="Выберите контрагентов"
                                                        formControlName="projectContractors"
                                                        [ngClass]="{ 'is-invalid': submitted && commonFormControls.projectContractors.errors }"
                                                >
                                                </ng-select>
                                                <div *ngIf="submitted && commonFormControls.projectContractors.errors"
                                                     class="invalid-feedback">
                                                    <span *ngIf="commonFormControls.projectContractors.errors.required"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- end col -->
                                    <div class="col-xl-4">
                                        <div class="card-box">
                                            <div *ngIf="commonFormControls?.projectContractors?.value"
                                                 class="widget-chart text-center" dir="ltr">

                                                <div *ngFor="let contractor of commonFormControls?.projectContractors?.value;">
                                                    <h5 [ngStyle]="{'color': getColorByPercentage(commonFormControls?.projectContractors?.value | contractorsCost : priceList : commonFormControls?.projectPostFormat?.value?.postFormat, commonFormControls?.projectBudget?.value || 0)}"
                                                        *ngFor="let format of contractor?.postformatlistSet;">
                                                        {{ format?.postFormat === commonFormControls?.projectPostFormat?.value?.postFormat ? '— ' + contractor?.editorName + ' ' + getContractorPrice(contractor, format) : ''}}
                                                    </h5>
                                                </div>

                                                <p>
                                                    Кол-во размещений: сделано
                                                    {{commonFormControls?.projectContractors?.value | contractorsNewsAmount : commonFormControls?.projectPostFormat?.value?.postFormat}}
                                                    /{{commonFormControls?.projectContractors?.value | contractorsArrangement : commonFormControls?.projectPostFormat?.value?.postFormat}}
                                                </p>

                                                <p>
                                                    Бюджет: <span
                                                        [ngStyle]="{'color': getColorByPercentage(commonFormControls?.projectContractors?.value | contractorsCost : priceList : commonFormControls?.projectPostFormat?.value?.postFormat, commonFormControls?.projectBudget?.value || 0)}">
                                                    {{commonFormControls?.projectContractors?.value | contractorsCost : priceList : commonFormControls?.projectPostFormat?.value?.postFormat}}
                                                </span>/{{commonFormControls?.projectBudget?.value || 0}}
                                                </p>
                                            </div>
                                        </div>
                                        <!-- end card-box -->
                                    </div>
                                    <!-- end col-->
                                </div>
                                <!-- end row -->
                                <ul class="list-inline wizard mb-0">
                                    <li class="next list-inline-item float-right">
                                        <button [disabled]="validationForm.status === 'INVALID'"
                                                class="btn btn-secondary"
                                                [awGoToStep]="{stepIndex: steps[commonFormControls?.projectBurstMethod?.value?.method]}"
                                                type="submit"
                                        >Дальше
                                        </button>
                                    </li>
                                </ul>
                            </form>
                        </aw-wizard-step>

                        <aw-wizard-step (stepEnter)="step = 1" awOptionalStep [canEnter]="validationForm?.valid">
                            <ul class="nav nav-pills bg-light nav-justified form-wizard-header mb-4">
                                <li class="nav-item" [awGoToStep]="{ stepIndex: 0 }">
                                    <a
                                            href="javascript: void(0);"
                                            data-toggle="tab"
                                            [ngClass]="{ active: step == 0 }"
                                            class="nav-link rounded-0 pt-2 pb-2"
                                    >
                                        <i class="mdi mdi-account-circle mr-1"></i>
                                        <span class="d-none d-sm-inline">Общее</span>
                                    </a>
                                </li>

                                <li *ngIf="!commonFormControls?.projectBurstMethod?.value?.method" class="nav-item">
                                    <a href="javascript: void(0);" class="nav-link rounded-0 pt-2 pb-2">
                                        <span class="d-none d-sm-inline">...</span>
                                    </a>
                                </li>

                                <li *ngIf="commonFormControls?.projectBurstMethod?.value?.method == methods.bayer || commonFormControls?.projectBurstMethod?.value?.method == methods.topSecret"
                                    class="nav-item" [awGoToStep]="{ stepIndex: 1 }"
                                >
                                    <a
                                            href="javascript: void(0);"
                                            data-toggle="tab"
                                            [ngClass]="{ active: step == 1 }"
                                            class="nav-link rounded-0 pt-2 pb-2"
                                    >
                                        <i class="mdi mdi-face-profile mr-1"></i>
                                        <span class="d-none d-sm-inline">Формирование</span>
                                    </a>
                                </li>

                                <li *ngIf="commonFormControls?.projectBurstMethod?.value?.method == methods.direct"
                                    class="nav-item"
                                    [awGoToStep]="{ stepIndex: 2 }">
                                    <a
                                            href="javascript: void(0);"
                                            data-toggle="tab"
                                            [ngClass]="{ active: step == 2 }"
                                            class="nav-link rounded-0 pt-2 pb-2"
                                    >
                                        <i class="mdi mdi-face-profile mr-1"></i>
                                        <span class="d-none d-sm-inline">Распределение</span>
                                    </a>
                                </li>

                                <li class="nav-item" [awGoToStep]="{ stepIndex: 3 }">
                                    <a
                                            href="javascript: void(0);"
                                            data-toggle="tab"
                                            [ngClass]="{ active: step == 3 }"
                                            class="nav-link rounded-0 pt-2 pb-2"
                                    >
                                        <i class="mdi mdi-checkbox-marked-circle-outline mr-1"></i>
                                        <span class="d-none d-sm-inline">Предпросмотр</span>
                                    </a>
                                </li>
                            </ul>
                            <form (ngSubmit)="profileFormSubmit()" [formGroup]="editorForm">
                                <quill-editor
                                        [styles]="{ height: '400px', 'margin-bottom': '15px' }"
                                        (onFocus)="onEvent($event, true)"
                                        (onBlur)="onEvent($event, false)"
                                        formControlName="text"
                                        (change)="onChangeFormationText()"
                                        (onEditorCreated)="created($event)"
                                ></quill-editor>

                                <div class="row">
                                    <div class="col-12">
                                        <div class="card">
                                            <div class="card-body">
                                                <file-upload formControlName="attachments"
                                                             class="dropzone"
                                                             (change)="onChangeFormationFiles($event)"
                                                >
                                                </file-upload>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <ul class="list-inline wizard mb-0">
                                    <li class="previous list-inline-item">
                                        <button class="btn btn-secondary"
                                                type="button"
                                                [awGoToStep]="{stepIndex: 0}"
                                        >Назад
                                        </button>
                                    </li>
                                    <li class="next list-inline-item float-right">
                                        <button class="btn btn-secondary"
                                                [awGoToStep]="{stepIndex: 3}"
                                                type="submit"
                                        >Дальше
                                        </button>
                                    </li>
                                </ul>
                            </form>
                        </aw-wizard-step>

                        <aw-wizard-step (stepEnter)="step = 2" awOptionalStep [canEnter]="validationForm?.valid">
                            <ul class="nav nav-pills bg-light nav-justified form-wizard-header mb-4">
                                <li class="nav-item" [awGoToStep]="{ stepIndex: 0 }">
                                    <a
                                            href="javascript: void(0);"
                                            data-toggle="tab"
                                            [ngClass]="{ active: step == 0 }"
                                            class="nav-link rounded-0 pt-2 pb-2"
                                    >
                                        <i class="mdi mdi-account-circle mr-1"></i>
                                        <span class="d-none d-sm-inline">Общее</span>
                                    </a>
                                </li>

                                <li *ngIf="!commonFormControls?.projectBurstMethod?.value?.method" class="nav-item">
                                    <a href="javascript: void(0);" class="nav-link rounded-0 pt-2 pb-2">
                                        <span class="d-none d-sm-inline">...</span>
                                    </a>
                                </li>

                                <li *ngIf="commonFormControls?.projectBurstMethod?.value?.method == methods.bayer || commonFormControls?.projectBurstMethod?.value?.method == methods.topSecret"
                                    class="nav-item" [awGoToStep]="{ stepIndex: 1 }"
                                >
                                    <a
                                            href="javascript: void(0);"
                                            data-toggle="tab"
                                            [ngClass]="{ active: step == 1 }"
                                            class="nav-link rounded-0 pt-2 pb-2"
                                    >
                                        <i class="mdi mdi-face-profile mr-1"></i>
                                        <span class="d-none d-sm-inline">Формирование</span>
                                    </a>
                                </li>

                                <li *ngIf="commonFormControls?.projectBurstMethod?.value?.method == methods.direct"
                                    class="nav-item"
                                    [awGoToStep]="{ stepIndex: 2 }">
                                    <a
                                            href="javascript: void(0);"
                                            data-toggle="tab"
                                            [ngClass]="{ active: step == 2 }"
                                            class="nav-link rounded-0 pt-2 pb-2"
                                    >
                                        <i class="mdi mdi-face-profile mr-1"></i>
                                        <span class="d-none d-sm-inline">Распределение</span>
                                    </a>
                                </li>

                                <li class="nav-item" [awGoToStep]="{ stepIndex: 3 }">
                                    <a
                                            href="javascript: void(0);"
                                            data-toggle="tab"
                                            [ngClass]="{ active: step == 3 }"
                                            class="nav-link rounded-0 pt-2 pb-2"
                                    >
                                        <i class="mdi mdi-checkbox-marked-circle-outline mr-1"></i>
                                        <span class="d-none d-sm-inline">Предпросмотр</span>
                                    </a>
                                </li>
                            </ul>
                            <form (ngSubmit)="newsFormSubmit()" [formGroup]="newsForm">
                                <div class="row">
                                    <div class="col-md-3 col-xl-6" *ngFor="let news of newsList; index as index">
                                        <!-- Simple card -->

                                        <div class="card">

                                            <div class="card-body">
                                                <div class="card-widgets" *ngIf="index !== 0">
                                                    <a href="javascript:void(0);" (click)="onDeleteNews(index)">
                                                        <i class="mdi mdi-close"></i>
                                                    </a>
                                                </div>
                                                <div>
                                                    <file-upload [formControl]="getControl(index, 'attachments')"
                                                                 (change)="updateField(index, 'attachments')"
                                                                 style="margin-bottom: 10px;"
                                                                 class="dropzone"
                                                    ></file-upload>
                                                </div>

                                                <input type="text"
                                                       placeholder="Введите заглавие"
                                                       [id]="'title' + index"
                                                       [formControl]="getControl(index, 'title')"
                                                       style="margin-bottom: 10px;"
                                                       class="form-control"
                                                       (change)="updateField(index, 'title')"
                                                />
                                                <quill-editor [styles]="{ height: '200px', 'margin-bottom': '15px' }"
                                                              [id]="'text-content' + index"
                                                              [formControl]="getControl(index, 'content')"
                                                              (onBlur)="updateField(index, 'content')"
                                                ></quill-editor>
<!--                                                <textarea placeholder="Введите содержание"-->
<!--                                                       [id]="'content' + index"-->
<!--                                                       [formControl]="getControl(index, 'content')"-->
<!--                                                       style="margin-bottom: 10px;"-->
<!--                                                       class="form-control"-->
<!--                                                       (change)="updateField(index, 'content')"></textarea>-->
                                                <ng-select
                                                        id="news-contractors"
                                                        [items]="commonFormControls.projectContractors.value || []"
                                                        bindLabel="editorName"
                                                        [multiple]="true"
                                                        [closeOnSelect]="false"
                                                        [clearSearchOnAdd]="true"
                                                        [hideSelected]="true"
                                                        placeholder="Контрагенты"
                                                        (change)="updateField(index, 'contractors')"
                                                        [formControl]="getControl(index, 'contractors')"
                                                        [ngClass]="{ 'is-invalid': submitted && distributeFormControls.contractors.errors }"
                                                >
                                                </ng-select>

                                                <a
                                                        *ngIf="index === newsList.length - 1"
                                                        (click)="addNew()"
                                                        href="javascript: void(0);"
                                                        class="btn btn-primary btn-block mt-3 waves-effect waves-light"
                                                >
                                                    <i class="mdi mdi-plus-circle"></i>
                                                    Добавить вариант
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                            <ul class="list-inline wizard mb-0">
                                <li class="previous list-inline-item">
                                    <button class="btn btn-secondary"
                                            type="button"
                                            [awGoToStep]="{stepIndex: 0}"
                                    >Назад
                                    </button>
                                </li>
                                <li class="next list-inline-item float-right">
                                    <button class="btn btn-secondary"
                                            [awGoToStep]="{stepIndex: 3}"
                                            type="submit"
                                    >Дальше
                                    </button>
                                </li>
                            </ul>
                        </aw-wizard-step>

                        <aw-wizard-step (stepEnter)="step = 3" [canEnter]="validationForm?.valid">
                            <ul class="nav nav-pills bg-light nav-justified form-wizard-header mb-4">
                                <li class="nav-item" [awGoToStep]="{ stepIndex: 0 }">
                                    <a
                                            href="javascript: void(0);"
                                            data-toggle="tab"
                                            [ngClass]="{ active: step == 0 }"
                                            class="nav-link rounded-0 pt-2 pb-2"
                                    >
                                        <i class="mdi mdi-account-circle mr-1"></i>
                                        <span class="d-none d-sm-inline">Общее</span>
                                    </a>
                                </li>

                                <li *ngIf="!commonFormControls?.projectBurstMethod?.value?.method" class="nav-item">
                                    <a href="javascript: void(0);" class="nav-link rounded-0 pt-2 pb-2">
                                        <span class="d-none d-sm-inline">...</span>
                                    </a>
                                </li>

                                <li *ngIf="commonFormControls?.projectBurstMethod?.value?.method == methods.bayer || commonFormControls?.projectBurstMethod?.value?.method == methods.topSecret"
                                    class="nav-item" [awGoToStep]="{ stepIndex: 1 }"
                                >
                                    <a
                                            href="javascript: void(0);"
                                            data-toggle="tab"
                                            [ngClass]="{ active: step == 1 }"
                                            class="nav-link rounded-0 pt-2 pb-2"
                                    >
                                        <i class="mdi mdi-face-profile mr-1"></i>
                                        <span class="d-none d-sm-inline">Формирование</span>
                                    </a>
                                </li>

                                <li *ngIf="commonFormControls?.projectBurstMethod?.value?.method == methods.direct"
                                    class="nav-item"
                                    [awGoToStep]="{ stepIndex: 2 }">
                                    <a
                                            href="javascript: void(0);"
                                            data-toggle="tab"
                                            [ngClass]="{ active: step == 2 }"
                                            class="nav-link rounded-0 pt-2 pb-2"
                                    >
                                        <i class="mdi mdi-face-profile mr-1"></i>
                                        <span class="d-none d-sm-inline">Распределение</span>
                                    </a>
                                </li>

                                <li class="nav-item" [awGoToStep]="{ stepIndex: 3 }">
                                    <a
                                            href="javascript: void(0);"
                                            data-toggle="tab"
                                            [ngClass]="{ active: step == 3 }"
                                            class="nav-link rounded-0 pt-2 pb-2"
                                    >
                                        <i class="mdi mdi-checkbox-marked-circle-outline mr-1"></i>
                                        <span class="d-none d-sm-inline">Предпросмотр</span>
                                    </a>
                                </li>
                            </ul>
                            <form (ngSubmit)="previewFormSubmit()" [formGroup]="previewForm">
                                <div class="row">
                                    <div class="col-md-12">
                                        <app-ui-preloader [display]="loading$ | async"></app-ui-preloader>

                                        <div *ngIf="commonFormControls?.projectBurstMethod?.value?.method == methods.direct; else elseBlock">
                                            <div *ngFor="let news of newsList; let i = index">
                                                <div class="form-row">
                                                    <div class="form-group col-md-4">
                                                        <label for="previewEmails" class="col-form-label">Почта</label>
                                                        <ng-select
                                                                id="previewEmails"
                                                                [items]="emails$ | async"
                                                                bindLabel="email"
                                                                [clearSearchOnAdd]="true"
                                                                [multiple]="false"
                                                                [closeOnSelect]="true"
                                                                [hideSelected]="true"
                                                                placeholder="Выберите почту"
                                                                [formControl]="getControl(i, 'previewEmail')"
                                                                [ngClass]="{ 'is-invalid': getControl(i, 'previewEmail')?.errors }"
                                                        >
                                                        </ng-select>
                                                    </div>
                                                    <div class="form-group col-md-4">
                                                        <label for="previewTemplate"
                                                               class="col-form-label">Шаблон</label>
                                                        <input placeholder="Шаблон"
                                                               tabindex="0"
                                                               id="previewTemplate"
                                                               class="form-control"
                                                               type="text"
                                                               readonly="readonly"
                                                               [value]="getControl(i, 'previewEmail')?.value?.template || null"
                                                        >
                                                    </div>
                                                    <div class="form-group col-md-4">
                                                        <label for="previewSignature"
                                                               class="col-form-label">Подпись</label>
                                                        <input placeholder="Подпись"
                                                               id="previewSignature"
                                                               class="form-control"
                                                               tabindex="0"
                                                               type="text"
                                                               readonly="readonly"
                                                               [value]="getControl(i, 'previewEmail')?.value?.signature || null"
                                                        >
                                                    </div>
                                                </div>

                                                <quill-editor [styles]="{ height: '400px', 'margin-bottom': '15px' }"
                                                              (onFocus)="onEvent($event, true)"
                                                              (onBlur)="onEvent($event, false)"
                                                              [formControl]="getControl(i, 'previewText')"
                                                              (onEditorCreated)="created($event)"
                                                ></quill-editor>

                                                <div class="row" *ngIf="news.attachments.length">
                                                    <div *ngFor="let attachment of news.attachments" class="col-sm-2">
                                                        <a (click)="downloadAttachment(attachment)" href="javascript: void(0)">
                                                            <img [src]="attachment.type.includes('image') ? attachment.base64 : 'assets/images/attached-files/img-1.jpg'" [alt]="attachment.name" class="img-thumbnail img-responsive">
                                                            <i>{{attachment.name}} ({{bytesToSize(attachment.size)}})</i>
                                                        </a>
                                                    </div>
                                                </div>

                                                <div class="row contractors-list">
                                                    <span *ngFor="let contractor of news.contractors" class="text-muted mb-4 mt-3">
                                                        {{contractor.editorName}}
                                                    </span>&nbsp;
                                                </div>
                                            </div>
                                        </div>
                                        <ng-template #elseBlock>
                                            <div class="form-row">
                                                <div class="form-group col-md-4">
                                                    <label for="previewEmail" class="col-form-label">Почта</label>
                                                    <ng-select
                                                            id="previewEmail"
                                                            [items]="emails$ | async"
                                                            bindLabel="email"
                                                            [multiple]="false"
                                                            [clearSearchOnAdd]="true"
                                                            [closeOnSelect]="true"
                                                            [hideSelected]="true"
                                                            placeholder="Выберите почту"
                                                            formControlName="previewEmail"
                                                            [ngClass]="{ 'is-invalid': previewFormControls?.previewEmail?.errors }"
                                                    >
                                                    </ng-select>
                                                </div>
                                                <div class="form-group col-md-4">
                                                    <label for="previewTemplateWave"
                                                           class="col-form-label">Шаблон</label>
                                                    <input placeholder="Шаблон"
                                                           tabindex="0"
                                                           id="previewTemplateWave"
                                                           class="form-control"
                                                           type="text"
                                                           readonly="readonly"
                                                           [value]="previewFormControls?.previewEmail?.value?.template || null"
                                                    >
                                                </div>
                                                <div class="form-group col-md-4">
                                                    <label for="previewSignatureWave"
                                                           class="col-form-label">Подпись</label>
                                                    <input placeholder="Подпись"
                                                           id="previewSignatureWave"
                                                           class="form-control"
                                                           tabindex="0"
                                                           type="text"
                                                           readonly="readonly"
                                                           [value]="previewFormControls?.previewEmail?.value?.signature || null"
                                                    >
                                                </div>
                                            </div>
                                            <quill-editor
                                                    [styles]="{ height: '400px', 'margin-bottom': '15px' }"
                                                    (onFocus)="onEvent($event, true)"
                                                    (onBlur)="onEvent($event, false)"
                                                    formControlName="previewText"
                                            ></quill-editor>

                                            <div class="row" *ngIf="editorForm.controls.attachments.value?.length">
                                                <div *ngFor="let attachment of editorForm.controls.attachments.value" class="col-sm-2">
                                                    <a (click)="downloadAttachment(attachment)" href="javascript: void(0)">
                                                        <img [src]="attachment.type.includes('image') ? attachment.base64 : 'assets/images/attached-files/img-1.jpg'" [alt]="attachment.name" class="img-thumbnail img-responsive">
                                                        <i>{{attachment.name}} ({{bytesToSize(attachment.size)}})</i>
                                                    </a>
                                                </div>
                                            </div>

                                        </ng-template>

                                        <div class="col-12">
                                            <div class="text-center">
                                                <div class="mb-3">
                                                    <div class="custom-control custom-checkbox">
                                                        <input type="checkbox"
                                                               class="custom-control-input"
                                                               formControlName="agreed"
                                                               id="customCheck1"/>
                                                        <label class="custom-control-label" for="customCheck1">
                                                            Я проверил(а) выше сделанное.
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- end col -->
                                    </div>
                                </div>
                            </form>

                            <!-- end row -->
                            <ul class="list-inline wizard mb-0">
                                <li class="previous list-inline-item">
                                    <button class="btn btn-secondary"
                                            [awGoToStep]="{stepIndex: steps[commonFormControls?.projectBurstMethod?.value?.method]}"
                                    >
                                        Назад
                                    </button>
                                </li>
                                <li class="next list-inline-item float-right">
                                    <button class="btn btn-secondary"
                                            type="submit"
                                            [disabled]="!previewForm?.controls?.agreed?.value"
                                            (click)="onSubmit()"
                                    >
                                        Отправить
                                    </button>
                                </li>
                            </ul>
                        </aw-wizard-step>
                    </aw-wizard>
                </div>
            </div>
        </div>
    </div>
</div>


<ng-template #editPrice role="document" let-modal="close">
    <div class="modal-header bg-dark" id="edit-client-modal">
        <h4 class="modal-title text-white">Редактирование цен</h4>
        <button
                type="button"
                class="close text-white"
                aria-label="Close"
                id="closeEditPrice"
                (click)="modal('Cross click')"
        >
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body p-3">
        <div class="text-left">
            <form (ngSubmit)="setPrices()" [formGroup]="priceForm">

                <div *ngFor="let contractor of commonFormControls?.projectContractors?.value; let idx = index"
                     class="form-group mb-3">
                    <label [for]="'title' + idx">Цена для {{contractor.editorName}}</label>
                    <input type="text"
                           placeholder="Введите цену"
                           [id]="'title' + idx"
                           [formControl]="getPriceControl(idx, 'price')"
                           style="margin-bottom: 10px;"
                           class="form-control"
                           (change)="updatePriceField(idx, 'price')"
                    />
                    <div *ngIf="submitted && getPriceControl(idx, 'price').errors" style="display: block"
                         class="invalid-feedback">
                        <div *ngIf="getPriceControl(idx, 'price').errors.required">Цена обязательна</div>
                    </div>
                </div>


                <div class="text-right">
                    <button type="button" id="cancel-new-user-button" class="btn btn-danger ml-1"
                            (click)="modal('close click')">
                        Отменить
                    </button>
                </div>
            </form>
        </div>
    </div>
</ng-template>
